@ECHO OFF

IF "%1"=="" GOTO NOARG

IF NOT EXIST %1\SYSTEM\IOSUBSYS\ESDI_506.PDR GOTO BADPATH
IF NOT EXIST PATCHES\IO.SYS GOTO NOINST
ATTRIB.EXE -S -H -R C:\IO.SYS

IF EXIST C:\IO.BAK GOTO UNINST
IF EXIST %1\DBLBUFF.BAK GOTO UNINST
IF EXIST %1\SMARTDRV.BAK GOTO UNINST
IF EXIST %1\SYSTEM\IOSUBSYS\ESDI_506.BAK GOTO UNINST
IF EXIST %1\SYSTEM\VMM32\IOS.BAK GOTO UNINST
IF EXIST %1\SYSTEM\VMM32\VFAT.BAK GOTO UNINST

IF NOT EXIST C:\IO.SYS GOTO MISSING
IF NOT EXIST %1\DBLBUFF.SYS GOTO MISSING
IF NOT EXIST %1\SMARTDRV.EXE GOTO MISSING
IF NOT EXIST %1\SYSTEM\IOSUBSYS\ESDI_506.PDR GOTO MISSING

REN C:\IO.SYS IO.BAK
REN %1\DBLBUFF.SYS DBLBUFF.BAK
REN %1\SMARTDRV.EXE SMARTDRV.BAK
REN %1\SYSTEM\IOSUBSYS\ESDI_506.PDR ESDI_506.BAK
REN %1\SYSTEM\VMM32\IOS.VXD IOS.BAK
REN %1\SYSTEM\VMM32\VFAT.VXD VFAT.BAK

COPY PATCHES\IO.SYS C:\IO.SYS
COPY PATCHES\DBLBUFF.SYS %1\DBLBUFF.SYS
COPY PATCHES\SMARTDRV.EXE %1\SMARTDRV.EXE
COPY PATCHES\ESDI_506.PDR %1\SYSTEM\IOSUBSYS\ESDI_506.PDR
COPY PATCHES\IOS.VXD %1\SYSTEM\VMM32\IOS.VXD
COPY PATCHES\VFAT.VXD %1\SYSTEM\VMM32\VFAT.VXD
COPY PATCHES\SATA.INF %1\INF\SATA.INF
COPY PATCHES\ATA0104.INF %1\INF\ATA0104.INF
COPY PATCHES\ATA0106.INF %1\INF\ATA0106.INF
COPY PATCHES\SATA0180.INF %1\INF\SATA0180.INF

ECHO TBPLUS PATCHES INSTALLED SUCCESSFULLY
GOTO EXIT
:CPERR
ECHO ERROR COPYING NEW FILES
GOTO EXIT
:BKERR
ECHO ERROR RENAMING ORIGINAL FILES
GOTO EXIT
:UNINST

IF NOT EXIST C:\IO.BAK GOTO MOD
IF NOT EXIST %1\DBLBUFF.BAK GOTO MOD
IF NOT EXIST %1\SMARTDRV.BAK GOTO MOD
IF NOT EXIST %1\SYSTEM\IOSUBSYS\ESDI_506.BAK GOTO MOD

ECHO TBPLUS PATCHES ALREADY APPLIED - RUN UNINST TO REMOVE
GOTO EXIT
:MOD
ECHO ONE OR MORE FILES ALREADY PATCHED - UNINSTALL PATCHES FIRST
GOTO EXIT
:MISSING
ECHO FILES MISSING OR WINDOWS DAMAGED
GOTO EXIT
:NOINST
ECHO PATCH FILE DIRECTORY NOT IN CURRENT DIRECTORY
GOTO EXIT
:BADPATH
ECHO WINDOWS PATH INCORRECT OR WINDOWS DAMAGED
GOTO EXIT
:NOARG
ECHO WINDOWS DIRECTORY PATH MUST BE SPECIFIED
:EXIT
@ECHO ON
